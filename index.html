<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FocusFlow | Production Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- Google Fonts -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap');
        
        body { font-family: 'Inter', sans-serif; margin: 0; padding: 0; overflow: hidden; background: #111; color: #fff; }
        
        /* Ultra Glass Theme - Refined */
        .glass-panel { 
            background: rgba(255, 255, 255, 0.15); 
            backdrop-filter: blur(25px); 
            -webkit-backdrop-filter: blur(25px); 
            border: 1px solid rgba(255, 255, 255, 0.2); 
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2); 
        }
        
        .glass-sidebar {
            background: rgba(20, 20, 20, 0.4); /* Slightly darker for contrast */
            backdrop-filter: blur(30px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .glass-header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Draggable Cards */
        .block-card { 
            transition: transform 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94), background 0.2s;
            border-left: 4px solid transparent;
            background: rgba(255, 255, 255, 0.7); /* High opacity for readability against sharp BG */
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: #1f2937;
        }
        .block-card:hover { 
            transform: translateY(-2px); 
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .block-card.dragging {
            opacity: 0.5;
            border: 2px dashed #6366f1;
            background: rgba(255, 255, 255, 0.4);
        }
        
        .block-type-service { border-left-color: #4f46e5; } 
        .block-type-material { border-left-color: #ea580c; } 
        .block-type-milestone { border-left-color: #16a34a; } 

        /* Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.4); }

        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Inputs */
        input { background: transparent !important; transition: all 0.2s; }
        input:focus { outline: none; }
        input::placeholder { color: rgba(0,0,0,0.4); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- FIREBASE CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyCuQLeXXVYEgG9TJ1XR_FvlD1ABqsgEXX4",
            authDomain: "focus-flow-512ee.firebaseapp.com",
            projectId: "focus-flow-512ee",
            storageBucket: "focus-flow-512ee.firebasestorage.app",
            messagingSenderId: "861618381374",
            appId: "1:861618381374:web:4692b742e3661e539c676f",
            measurementId: "G-33P6VZPJ7Y"
        };

        let auth = null, db = null, isFirebaseEnabled = false;
        try {
            if (typeof firebase !== 'undefined' && firebaseConfig.apiKey) {
                if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                db = firebase.firestore();
                isFirebaseEnabled = true;
            }
        } catch (e) { console.error("Firebase Init Failed:", e); }

        // --- ICONS ---
        const Icon = ({ name, size = 18, className = "" }) => {
            const icons = {
                box: <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" />,
                layers: <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />,
                settings: <g><circle cx="12" cy="12" r="3" /><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" /></g>,
                trash: <path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2M10 11v6M14 11v6" />,
                plus: <path d="M12 5v14M5 12h14" />,
                check: <path d="M20 6L9 17l-5-5" />,
                link: <g><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" /><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" /></g>,
                dollar: <g><line x1="12" y1="1" x2="12" y2="23" /><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" /></g>,
                fileText: <g><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" /><polyline points="14 2 14 8 20 8" /><line x1="16" y1="13" x2="8" y2="13" /><line x1="16" y1="17" x2="8" y2="17" /><polyline points="10 9 9 9 8 9" /></g>,
                logOut: <g><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" /><polyline points="16 17 21 12 16 7" /><line x1="21" y1="12" x2="9" y2="12" /></g>,
                chevronRight: <polyline points="9 18 15 12 9 6" />,
                image: <g><rect x="3" y="3" width="18" height="18" rx="2" ry="2" /><circle cx="8.5" cy="8.5" r="1.5" /><polyline points="21 15 16 10 5 21" /></g>,
                x: <g><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></g>,
                grip: <g><circle cx="9" cy="12" r="1" /><circle cx="9" cy="5" r="1" /><circle cx="9" cy="19" r="1" /><circle cx="15" cy="12" r="1" /><circle cx="15" cy="5" r="1" /><circle cx="15" cy="19" r="1" /></g>,
                upload: <g><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="17 8 12 3 7 8" /><line x1="12" y1="3" x2="12" y2="15" /></g>
            };
            return <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{icons[name]}</svg>;
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [settings, setSettings] = useState({ companyName: "Production Studio", logoUrl: "", bgImage: "https://images.unsplash.com/photo-1600607686527-6fb886090705?q=80&w=2727&auto=format&fit=crop" });
            const [projects, setProjects] = useState([]);
            const [activeProjectId, setActiveProjectId] = useState(null);
            const [showSettings, setShowSettings] = useState(false);
            const [showInvoice, setShowInvoice] = useState(false);
            const [draggedItemIndex, setDraggedItemIndex] = useState(null);
            const fileInputRef = useRef(null);

            const activeProject = projects.find(p => p.id === activeProjectId) || { name: "Untitled Project", blocks: [] };

            useEffect(() => {
                if (!isFirebaseEnabled) return;
                return auth.onAuthStateChanged((u) => {
                    setUser(u);
                    if (u) {
                        db.collection('users').doc(u.uid).collection('settings').doc('config').onSnapshot(doc => {
                            if(doc.exists) setSettings(prev => ({...prev, ...doc.data()}));
                        });
                        db.collection('users').doc(u.uid).collection('projects').orderBy('updatedAt', 'desc').onSnapshot(snapshot => {
                            const loadedProjects = snapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
                            setProjects(loadedProjects);
                            if(loadedProjects.length > 0 && !activeProjectId) setActiveProjectId(loadedProjects[0].id);
                        });
                    }
                });
            }, [activeProjectId]);

            const login = async () => { try { await auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); } catch (e) { alert(e.message); } };
            const logout = () => auth.signOut();

            const createProject = async () => {
                const name = prompt("Enter Project Name:");
                if(name && user) {
                    const docRef = await db.collection('users').doc(user.uid).collection('projects').add({
                        name, blocks: [], createdAt: Date.now(), updatedAt: Date.now()
                    });
                    setActiveProjectId(docRef.id);
                }
            };

            const updateSettings = (newSettings) => {
                setSettings(newSettings);
                if(user) db.collection('users').doc(user.uid).collection('settings').doc('config').set(newSettings, { merge: true });
            };

            const handleLogoUpload = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                
                if (file.size > 500000) { // Limit to 500KB
                    alert("Image is too large! Please use a logo smaller than 500KB.");
                    return;
                }

                const reader = new FileReader();
                reader.onloadend = () => {
                    const base64String = reader.result;
                    const newSettings = { ...settings, logoUrl: base64String };
                    setSettings(newSettings);
                    if(user) db.collection('users').doc(user.uid).collection('settings').doc('config').set(newSettings, { merge: true });
                };
                reader.readAsDataURL(file);
            };

            const addBlock = async (type) => {
                if(!activeProjectId) return alert("Create a project first!");
                const newBlock = {
                    id: Date.now().toString(),
                    type, 
                    title: type === 'service' ? 'New Service' : type === 'material' ? 'New Material' : 'New Milestone',
                    price: 0, link: '', notes: '', completed: false
                };
                const updatedBlocks = [...activeProject.blocks, newBlock];
                updateProjectBlocks(updatedBlocks);
            };

            const updateBlock = (blockId, field, value) => {
                const updatedBlocks = activeProject.blocks.map(b => b.id === blockId ? { ...b, [field]: value } : b);
                updateProjectBlocks(updatedBlocks);
            };

            const deleteBlock = (blockId) => {
                if(confirm("Delete this item?")) {
                    const updatedBlocks = activeProject.blocks.filter(b => b.id !== blockId);
                    updateProjectBlocks(updatedBlocks);
                }
            };

            const updateProjectBlocks = (blocks) => {
                const updatedProject = { ...activeProject, blocks, updatedAt: Date.now() };
                setProjects(projects.map(p => p.id === activeProjectId ? updatedProject : p)); // Optimistic
                if(user) db.collection('users').doc(user.uid).collection('projects').doc(activeProjectId).update({ blocks, updatedAt: Date.now() });
            };

            // Drag & Drop
            const handleDragStart = (index) => setDraggedItemIndex(index);
            const handleDragEnter = (e, index) => {
                e.preventDefault();
                if (draggedItemIndex === null || draggedItemIndex === index) return;
                const newBlocks = [...activeProject.blocks];
                const item = newBlocks[draggedItemIndex];
                newBlocks.splice(draggedItemIndex, 1);
                newBlocks.splice(index, 0, item);
                setDraggedItemIndex(index);
                const updatedProject = { ...activeProject, blocks: newBlocks };
                setProjects(projects.map(p => p.id === activeProjectId ? updatedProject : p));
            };
            const handleDragEnd = () => {
                setDraggedItemIndex(null);
                if(user) db.collection('users').doc(user.uid).collection('projects').doc(activeProjectId).update({ blocks: activeProject.blocks });
            };

            const getBlockIcon = (type) => {
                switch(type) {
                    case 'service': return 'box';
                    case 'material': return 'layers';
                    case 'milestone': return 'check';
                    default: return 'box';
                }
            };

            const totalEstimate = activeProject.blocks?.reduce((acc, b) => acc + (parseFloat(b.price) || 0), 0) || 0;

            if (!user) return (
                <div className="min-h-screen flex items-center justify-center bg-gray-900 bg-cover bg-center transition-all duration-700" style={{backgroundImage: `url('${settings.bgImage}')`}}>
                    <div className="absolute inset-0 bg-black/50 backdrop-blur-md"></div>
                    <div className="relative glass-panel p-10 rounded-2xl text-center max-w-md w-full">
                        <h1 className="text-3xl font-bold mb-2">FocusFlow</h1>
                        <p className="text-sm opacity-80 mb-6">Production Management Suite</p>
                        <button onClick={login} className="bg-white text-black px-6 py-3 rounded-xl font-bold shadow-lg hover:scale-105 transition flex items-center justify-center gap-2 w-full">
                            <Icon name="google" /> Sign In with Google
                        </button>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen flex text-gray-800 font-sans overflow-hidden bg-cover bg-center transition-all duration-700" style={{backgroundImage: `url('${settings.bgImage}')`}}>
                    <div className="absolute inset-0 bg-black/20"></div> {/* Removed backdrop-blur here */}
                    
                    {/* SIDEBAR */}
                    <div className="w-64 glass-sidebar flex flex-col z-10 shadow-2xl relative text-white">
                        <div className="p-5 border-b border-white/10">
                            <div className="mb-4">
                                {settings.logoUrl ? (
                                    <div className="relative group cursor-pointer" onClick={() => setShowSettings(true)}>
                                        <img src={settings.logoUrl} className="h-10 object-contain" alt="Logo" />
                                        <div className="absolute inset-0 bg-black/50 hidden group-hover:flex items-center justify-center text-xs rounded">Edit</div>
                                    </div>
                                ) : (
                                    <button onClick={() => setShowSettings(true)} className="h-10 border-2 border-dashed border-white/30 rounded flex items-center justify-center w-full text-xs text-white/50 hover:border-white/60 hover:text-white transition">
                                        + Add Logo
                                    </button>
                                )}
                            </div>
                            <h2 className="font-bold tracking-tight truncate">{settings.companyName}</h2>
                            <p className="text-[10px] uppercase tracking-wider text-white/50 font-semibold mt-1">Production Management</p>
                        </div>
                        
                        <div className="flex-1 overflow-y-auto p-3 space-y-1 custom-scrollbar">
                            <div className="flex justify-between items-center px-2 mb-2"><span className="text-xs font-bold text-white/40 uppercase">Projects</span><button onClick={createProject} className="text-white hover:bg-white/20 p-1 rounded"><Icon name="plus" size={14}/></button></div>
                            {projects.map(p => (
                                <button key={p.id} onClick={() => setActiveProjectId(p.id)} className={`w-full text-left px-3 py-2.5 rounded-lg text-sm font-medium flex items-center gap-2 transition-all ${activeProjectId === p.id ? 'bg-white/20 shadow-lg border border-white/10' : 'text-white/60 hover:bg-white/5'}`}>
                                    <Icon name="box" size={14} className={activeProjectId === p.id ? "text-white" : "text-white/40"} />
                                    <span className="truncate">{p.name}</span>
                                </button>
                            ))}
                        </div>

                        <div className="p-4 border-t border-white/10 bg-white/5">
                            <div className="flex items-center gap-3">
                                <img src={user.photoURL} className="w-8 h-8 rounded-full border border-white/30" />
                                <div className="flex-1 min-w-0"><p className="text-xs font-bold truncate">{user.displayName}</p></div>
                                <button onClick={() => setShowSettings(true)} className="text-white/60 hover:text-white" title="Settings"><Icon name="settings" /></button>
                            </div>
                        </div>
                    </div>

                    {/* WORKSPACE */}
                    <div className="flex-1 flex flex-col z-10 relative overflow-hidden">
                        <header className="h-16 glass-header flex justify-between items-center px-8 shadow-sm">
                            <div>
                                <h1 className="text-xl font-bold text-white drop-shadow-md">{activeProject.name}</h1>
                                <span className="text-xs text-white/60">Total Estimate</span>
                            </div>
                            <div className="flex items-center gap-4">
                                <p className="text-2xl font-bold text-white drop-shadow-md">${totalEstimate.toLocaleString()}</p>
                                <button onClick={() => setShowInvoice(true)} className="bg-white/20 border border-white/20 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-white/30 backdrop-blur transition-all flex items-center gap-2">
                                    <Icon name="fileText" size={16} /> Client View
                                </button>
                            </div>
                        </header>

                        <div className="flex-1 overflow-y-auto p-8 custom-scrollbar pb-32">
                            <div className="max-w-4xl mx-auto space-y-3">
                                {activeProject.blocks && activeProject.blocks.length === 0 && (
                                    <div className="text-center py-20 border-2 border-dashed border-white/20 rounded-xl bg-white/5 text-white/50 backdrop-blur-sm">
                                        <p>Select a tool from the right to start.</p>
                                    </div>
                                )}

                                {activeProject.blocks && activeProject.blocks.map((block, index) => (
                                    <div 
                                        key={block.id}
                                        draggable={true}
                                        onDragStart={() => handleDragStart(index)}
                                        onDragEnter={(e) => handleDragEnter(e, index)}
                                        onDragEnd={handleDragEnd}
                                        onDragOver={(e) => e.preventDefault()}
                                        className={`block-card p-4 shadow-lg flex gap-4 items-start group animate-fade-in block-type-${block.type} rounded-xl ${draggedItemIndex === index ? 'dragging' : ''}`}
                                    >
                                        <div className="pt-1 text-gray-400 cursor-grab hover:text-indigo-500">
                                            <Icon name="grip" size={16} />
                                        </div>
                                        <div className="pt-1 text-gray-600">
                                            <Icon name={getBlockIcon(block.type)} size={18} />
                                        </div>
                                        
                                        <div className="flex-1 space-y-2">
                                            <div className="flex justify-between items-start gap-4">
                                                <input type="text" value={block.title} onChange={(e) => updateBlock(block.id, 'title', e.target.value)} className="font-bold text-gray-900 text-lg w-full bg-transparent p-0 border-none focus:ring-0" />
                                                <div className="flex items-center gap-1 bg-white/50 px-2 py-1 rounded-md border border-white/40 shadow-sm shrink-0">
                                                    <span className="text-gray-500 text-xs">$</span>
                                                    <input type="number" value={block.price} onChange={(e) => updateBlock(block.id, 'price', e.target.value)} className="w-20 text-right font-mono font-medium text-sm text-gray-800" placeholder="0.00" />
                                                </div>
                                            </div>
                                            <div className="grid grid-cols-2 gap-4">
                                                <div className="flex items-center gap-2 bg-white/40 p-1.5 rounded-lg border border-white/20 focus-within:border-indigo-300 transition-colors">
                                                    <Icon name="link" size={12} className="text-gray-400" />
                                                    <input type="text" placeholder="Reference link..." value={block.link} onChange={(e) => updateBlock(block.id, 'link', e.target.value)} className="text-xs w-full text-blue-700" />
                                                </div>
                                                <div className="flex items-center gap-2 bg-white/40 p-1.5 rounded-lg border border-white/20 focus-within:border-indigo-300 transition-colors">
                                                    <Icon name="fileText" size={12} className="text-gray-400" />
                                                    <input type="text" placeholder="Notes..." value={block.notes} onChange={(e) => updateBlock(block.id, 'notes', e.target.value)} className="text-xs w-full text-gray-700" />
                                                </div>
                                            </div>
                                        </div>

                                        <div className="flex flex-col gap-2">
                                            <button onClick={() => updateBlock(block.id, 'completed', !block.completed)} className={`p-1.5 rounded-md shadow-sm transition-colors ${block.completed ? 'bg-green-500 text-white' : 'bg-white/50 text-gray-400 hover:text-green-600 hover:bg-green-50'}`}>
                                                <Icon name="check" size={16} />
                                            </button>
                                            <button onClick={() => deleteBlock(block.id)} className="p-1.5 rounded-md bg-white/50 text-gray-400 hover:text-red-600 hover:bg-red-50 shadow-sm transition-colors">
                                                <Icon name="trash" size={16} />
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* TOOLBOX */}
                    <div className="w-64 glass-sidebar border-l border-white/10 p-5 flex flex-col z-10 shadow-2xl text-white">
                        <h3 className="text-xs font-bold text-white/50 uppercase tracking-wider mb-4">Toolbox</h3>
                        <div className="space-y-3">
                            <button onClick={() => addBlock('service')} className="w-full bg-white/10 hover:bg-white/20 border border-white/10 p-3 rounded-xl flex items-center gap-3 transition-all text-left group">
                                <div className="w-8 h-8 rounded-lg bg-indigo-500/20 text-indigo-200 flex items-center justify-center border border-indigo-400/30 group-hover:bg-indigo-500 group-hover:text-white"><Icon name="box" /></div>
                                <div><p className="text-sm font-bold">Service</p><p className="text-[10px] text-white/50">Design, Dev</p></div>
                            </button>
                            <button onClick={() => addBlock('material')} className="w-full bg-white/10 hover:bg-white/20 border border-white/10 p-3 rounded-xl flex items-center gap-3 transition-all text-left group">
                                <div className="w-8 h-8 rounded-lg bg-orange-500/20 text-orange-200 flex items-center justify-center border border-orange-400/30 group-hover:bg-orange-500 group-hover:text-white"><Icon name="layers" /></div>
                                <div><p className="text-sm font-bold">Material</p><p className="text-[10px] text-white/50">Assets, Stock</p></div>
                            </button>
                            <button onClick={() => addBlock('milestone')} className="w-full bg-white/10 hover:bg-white/20 border border-white/10 p-3 rounded-xl flex items-center gap-3 transition-all text-left group">
                                <div className="w-8 h-8 rounded-lg bg-green-500/20 text-green-200 flex items-center justify-center border border-green-400/30 group-hover:bg-green-500 group-hover:text-white"><Icon name="check" /></div>
                                <div><p className="text-sm font-bold">Milestone</p><p className="text-[10px] text-white/50">Delivery</p></div>
                            </button>
                        </div>
                    </div>

                    {/* SETTINGS MODAL */}
                    {showSettings && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm">
                            <div className="glass-panel bg-white/95 p-6 w-96 rounded-2xl shadow-2xl animate-fade-in text-gray-800">
                                <div className="flex justify-between items-center mb-6"><h3 className="font-bold text-lg">Settings</h3><button onClick={() => setShowSettings(false)}><Icon name="x" /></button></div>
                                <div className="space-y-4">
                                    <div><label className="text-xs font-bold uppercase block mb-1">Company Name</label><input type="text" value={settings.companyName} onChange={(e) => updateSettings({...settings, companyName: e.target.value})} className="w-full p-2 border rounded-lg bg-white/50" /></div>
                                    
                                    {/* LOGO UPLOAD */}
                                    <div>
                                        <label className="text-xs font-bold uppercase block mb-1">Company Logo</label>
                                        <div className="flex gap-2">
                                            <button onClick={() => fileInputRef.current.click()} className="flex-1 p-2 border border-dashed rounded-lg bg-gray-50 hover:bg-gray-100 text-sm text-gray-500 flex items-center justify-center gap-2">
                                                <Icon name="upload" size={14} /> Upload from Device
                                            </button>
                                            <input type="file" ref={fileInputRef} onChange={handleLogoUpload} accept="image/*" className="hidden" />
                                        </div>
                                        <p className="text-[10px] text-gray-400 mt-1">Max size 500KB. Saved to Cloud.</p>
                                    </div>

                                    {/* WALLPAPER */}
                                    <div>
                                        <label className="text-xs font-bold uppercase block mb-1">Wallpaper</label>
                                        <input type="text" value={settings.bgImage} onChange={(e) => updateSettings({...settings, bgImage: e.target.value})} className="w-full p-2 border rounded-lg bg-white/50 text-xs mb-2" placeholder="Image URL..." />
                                        <a href="https://unsplash.com/wallpapers" target="_blank" className="text-[10px] text-indigo-600 hover:underline">Find HD Wallpapers on Unsplash â†—</a>
                                    </div>

                                    <div className="flex justify-between pt-4 border-t mt-4">
                                        <button onClick={logout} className="text-red-500 text-sm font-medium hover:underline">Sign Out</button>
                                        <button onClick={() => setShowSettings(false)} className="bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-lg hover:bg-indigo-700">Done</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* INVOICE MODAL */}
                    {showInvoice && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm">
                            <div className="bg-white w-[600px] rounded-sm shadow-2xl animate-fade-in p-8 text-gray-800">
                                <div className="flex justify-between border-b pb-6 mb-6">
                                    <div className="flex items-center gap-3">
                                        {settings.logoUrl && <img src={settings.logoUrl} className="h-12 object-contain" />}
                                        <h2 className="font-bold text-2xl">{settings.companyName}</h2>
                                    </div>
                                    <div className="text-right"><p className="text-xs text-gray-400">DATE</p><p className="font-bold">{new Date().toLocaleDateString()}</p></div>
                                </div>
                                <table className="w-full text-left text-sm">
                                    <thead><tr className="border-b text-gray-400 text-xs uppercase"><th className="pb-2">Item</th><th className="pb-2 text-right">Price</th></tr></thead>
                                    <tbody>{activeProject.blocks.map(b => (<tr key={b.id}><td className="py-3 border-b border-gray-100"><p className="font-bold">{b.title}</p><p className="text-gray-400 text-xs">{b.notes}</p></td><td className="py-3 border-b border-gray-100 text-right font-mono">${parseFloat(b.price||0).toLocaleString()}</td></tr>))}</tbody>
                                </table>
                                <div className="mt-6 flex justify-between items-center">
                                    <button onClick={() => setShowInvoice(false)} className="text-gray-400 text-sm hover:text-black">Close</button>
                                    <div className="text-right"><p className="text-xs text-gray-400 font-bold uppercase">Total</p><p className="text-3xl font-bold text-indigo-900">${totalEstimate.toLocaleString()}</p></div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>