<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FocusFlow | Production Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- Google Fonts -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap');
        
        body { font-family: 'Inter', sans-serif; margin: 0; padding: 0; overflow: hidden; background: #111; color: #fff; }
        
        /* Glassmorphism & UI Utilities */
        .glass-panel { 
            background: rgba(255, 255, 255, 0.75); 
            backdrop-filter: blur(20px); 
            -webkit-backdrop-filter: blur(20px); 
            border: 1px solid rgba(255, 255, 255, 0.8); 
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1); 
        }
        .glass-dark {
            background: rgba(20, 20, 20, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
        }

        /* Block Styles (Scratch-like feel) */
        .block-card { transition: all 0.2s ease; border-left: 4px solid transparent; }
        .block-card:hover { transform: translateX(2px); }
        .block-type-service { border-left-color: #4f46e5; } /* Indigo */
        .block-type-material { border-left-color: #ea580c; } /* Orange */
        .block-type-milestone { border-left-color: #16a34a; } /* Green */
        .block-type-legal { border-left-color: #dc2626; } /* Red */

        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(0,0,0,0.2); }

        .animate-fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- FIREBASE CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyCuQLeXXVYEgG9TJ1XR_FvlD1ABqsgEXX4",
            authDomain: "focus-flow-512ee.firebaseapp.com",
            projectId: "focus-flow-512ee",
            storageBucket: "focus-flow-512ee.firebasestorage.app",
            messagingSenderId: "861618381374",
            appId: "1:861618381374:web:4692b742e3661e539c676f",
            measurementId: "G-33P6VZPJ7Y"
        };

        // Initialize Firebase
        let auth = null, db = null, isFirebaseEnabled = false;
        try {
            if (typeof firebase !== 'undefined' && firebaseConfig.apiKey) {
                if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                db = firebase.firestore();
                isFirebaseEnabled = true;
            }
        } catch (e) { console.error("Firebase Init Failed:", e); }

        // --- ICONS ---
        const Icon = ({ name, size = 18, className = "" }) => {
            const icons = {
                box: <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" />,
                layers: <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />,
                settings: <g><circle cx="12" cy="12" r="3" /><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" /></g>,
                trash: <path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2M10 11v6M14 11v6" />,
                plus: <path d="M12 5v14M5 12h14" />,
                check: <path d="M20 6L9 17l-5-5" />,
                link: <g><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" /><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" /></g>,
                dollar: <g><line x1="12" y1="1" x2="12" y2="23" /><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" /></g>,
                fileText: <g><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" /><polyline points="14 2 14 8 20 8" /><line x1="16" y1="13" x2="8" y2="13" /><line x1="16" y1="17" x2="8" y2="17" /><polyline points="10 9 9 9 8 9" /></g>,
                logOut: <g><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" /><polyline points="16 17 21 12 16 7" /><line x1="21" y1="12" x2="9" y2="12" /></g>,
                chevronRight: <polyline points="9 18 15 12 9 6" />
            };
            return <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{icons[name]}</svg>;
        };

        // --- COMPONENTS ---

        const App = () => {
            // User & Global State
            const [user, setUser] = useState(null);
            const [isLoading, setIsLoading] = useState(true);
            const [settings, setSettings] = useState({ 
                companyName: "Production Studio", 
                logoUrl: "",
                bgImage: "https://images.unsplash.com/photo-1600607686527-6fb886090705?q=80&w=2727&auto=format&fit=crop" 
            });

            // Project State
            const [projects, setProjects] = useState([]);
            const [activeProjectId, setActiveProjectId] = useState(null);
            
            // UI State
            const [showSettings, setShowSettings] = useState(false);
            const [showInvoice, setShowInvoice] = useState(false);
            
            // Active Project Data
            const activeProject = projects.find(p => p.id === activeProjectId) || { name: "Untitled Project", blocks: [] };

            // --- AUTH & SYNC ---
            useEffect(() => {
                if (!isFirebaseEnabled) { setIsLoading(false); return; }
                
                const unsubscribe = auth.onAuthStateChanged((u) => {
                    setUser(u);
                    if (u) {
                        // Load Settings
                        db.collection('users').doc(u.uid).collection('settings').doc('config').onSnapshot(doc => {
                            if(doc.exists) setSettings(prev => ({...prev, ...doc.data()}));
                        });

                        // Load Projects List
                        db.collection('users').doc(u.uid).collection('projects').orderBy('updatedAt', 'desc').onSnapshot(snapshot => {
                            const loadedProjects = snapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
                            setProjects(loadedProjects);
                            if(loadedProjects.length > 0 && !activeProjectId) {
                                setActiveProjectId(loadedProjects[0].id);
                            }
                            setIsLoading(false);
                        });
                    } else {
                        setProjects([]);
                        setIsLoading(false);
                    }
                });
                return () => unsubscribe();
            }, [activeProjectId]);

            // --- ACTIONS ---

            const login = async () => {
                try { await auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); } catch (error) { alert(error.message); }
            };

            const logout = () => { auth.signOut(); };

            const createProject = async () => {
                const name = prompt("Enter Project Name (e.g., Nike Commercial):");
                if(!name) return;
                const newProject = {
                    name,
                    blocks: [],
                    createdAt: Date.now(),
                    updatedAt: Date.now(),
                    status: 'planning'
                };
                if(user) {
                    const docRef = await db.collection('users').doc(user.uid).collection('projects').add(newProject);
                    setActiveProjectId(docRef.id);
                }
            };

            const updateSettings = async (newSettings) => {
                setSettings(newSettings);
                if(user) await db.collection('users').doc(user.uid).collection('settings').doc('config').set(newSettings, { merge: true });
            };

            const addBlock = async (type) => {
                if(!activeProjectId) return alert("Create a project first!");
                
                const newBlock = {
                    id: Date.now().toString(),
                    type, // 'service', 'material', 'milestone', 'legal'
                    title: type === 'service' ? 'New Service' : type === 'material' ? 'New Material' : 'New Milestone',
                    price: 0,
                    link: '',
                    notes: '',
                    completed: false
                };

                const updatedBlocks = [...activeProject.blocks, newBlock];
                
                // Optimistic UI
                const updatedProject = { ...activeProject, blocks: updatedBlocks, updatedAt: Date.now() };
                setProjects(projects.map(p => p.id === activeProjectId ? updatedProject : p));

                if(user) {
                    await db.collection('users').doc(user.uid).collection('projects').doc(activeProjectId).update({
                        blocks: updatedBlocks,
                        updatedAt: Date.now()
                    });
                }
            };

            const updateBlock = async (blockId, field, value) => {
                const updatedBlocks = activeProject.blocks.map(b => b.id === blockId ? { ...b, [field]: value } : b);
                
                // Optimistic UI
                const updatedProject = { ...activeProject, blocks: updatedBlocks };
                setProjects(projects.map(p => p.id === activeProjectId ? updatedProject : p));

                if(user) {
                    // Debounce simple saves could be added here, but direct update for now
                    await db.collection('users').doc(user.uid).collection('projects').doc(activeProjectId).update({
                        blocks: updatedBlocks
                    });
                }
            };

            const deleteBlock = async (blockId) => {
                const updatedBlocks = activeProject.blocks.filter(b => b.id !== blockId);
                 const updatedProject = { ...activeProject, blocks: updatedBlocks };
                setProjects(projects.map(p => p.id === activeProjectId ? updatedProject : p));
                if(user) {
                    await db.collection('users').doc(user.uid).collection('projects').doc(activeProjectId).update({ blocks: updatedBlocks });
                }
            };

            // Calculated Stats
            const totalEstimate = activeProject.blocks?.reduce((acc, b) => acc + (parseFloat(b.price) || 0), 0) || 0;

            if (!user) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-gray-900 bg-cover bg-center" style={{backgroundImage: `url('${settings.bgImage}')`}}>
                        <div className="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>
                        <div className="relative glass-panel p-10 rounded-2xl text-center max-w-md w-full shadow-2xl">
                            <div className="mb-6 flex justify-center">
                                <div className="w-20 h-20 bg-indigo-600 rounded-2xl flex items-center justify-center shadow-lg transform rotate-3">
                                    <Icon name="layers" size={40} className="text-white" />
                                </div>
                            </div>
                            <h1 className="text-3xl font-bold text-gray-800 mb-2">FocusFlow</h1>
                            <p className="text-gray-600 mb-8 font-medium">Production Management Suite</p>
                            <button onClick={login} className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-xl flex items-center justify-center gap-3 transition-all transform hover:scale-105 shadow-xl">
                                <Icon name="google" /> Sign in with Company Email
                            </button>
                            <p className="mt-4 text-xs text-gray-500">Access your team's production lines securely.</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen flex text-gray-800 font-sans overflow-hidden bg-cover bg-center transition-all duration-700" style={{backgroundImage: `url('${settings.bgImage}')`}}>
                    <div className="absolute inset-0 bg-gray-100/40 backdrop-blur-xl"></div>
                    
                    {/* --- LEFT SIDEBAR (Projects) --- */}
                    <div className="w-64 bg-white/80 backdrop-blur-md border-r border-white/50 flex flex-col z-10 shadow-xl relative">
                        <div className="p-5 border-b border-gray-200/50">
                            {settings.logoUrl && <img src={settings.logoUrl} className="h-8 mb-3 object-contain" alt="Logo" />}
                            <h2 className="font-bold text-gray-800 tracking-tight">{settings.companyName}</h2>
                            <p className="text-[10px] uppercase tracking-wider text-gray-500 font-semibold mt-1">Production Management</p>
                        </div>
                        
                        <div className="flex-1 overflow-y-auto p-3 space-y-1 custom-scrollbar">
                            <div className="flex justify-between items-center px-2 mb-2">
                                <span className="text-xs font-bold text-gray-400 uppercase">Projects</span>
                                <button onClick={createProject} className="text-indigo-600 hover:bg-indigo-50 p-1 rounded"><Icon name="plus" size={14}/></button>
                            </div>
                            {projects.map(p => (
                                <button 
                                    key={p.id}
                                    onClick={() => setActiveProjectId(p.id)}
                                    className={`w-full text-left px-3 py-2.5 rounded-lg text-sm font-medium flex items-center gap-2 transition-all ${activeProjectId === p.id ? 'bg-indigo-600 text-white shadow-md' : 'text-gray-600 hover:bg-white/50'}`}
                                >
                                    <Icon name="box" size={14} className={activeProjectId === p.id ? "text-white" : "text-gray-400"} />
                                    <span className="truncate">{p.name}</span>
                                    {activeProjectId === p.id && <Icon name="chevronRight" size={12} className="ml-auto opacity-50" />}
                                </button>
                            ))}
                        </div>

                        <div className="p-4 border-t border-gray-200/50 bg-white/30">
                            <div className="flex items-center gap-3">
                                <img src={user.photoURL} className="w-8 h-8 rounded-full border border-white shadow-sm" />
                                <div className="flex-1 min-w-0">
                                    <p className="text-xs font-bold truncate text-gray-800">{user.displayName}</p>
                                    <p className="text-[10px] text-gray-500 truncate">Online</p>
                                </div>
                                <button onClick={() => setShowSettings(true)} className="text-gray-500 hover:text-indigo-600"><Icon name="settings" /></button>
                            </div>
                        </div>
                    </div>

                    {/* --- MAIN CANVAS (Production Line) --- */}
                    <div className="flex-1 flex flex-col z-10 relative overflow-hidden">
                        {/* Header */}
                        <header className="h-16 border-b border-white/50 bg-white/40 backdrop-blur-md flex justify-between items-center px-8 shadow-sm">
                            <div>
                                <h1 className="text-xl font-bold text-gray-800">{activeProject.name}</h1>
                                <div className="flex items-center gap-2 text-xs text-gray-500">
                                    <span className="bg-green-100 text-green-700 px-2 py-0.5 rounded-full font-medium">Active</span>
                                    <span>Last updated: {new Date(activeProject.updatedAt || Date.now()).toLocaleTimeString()}</span>
                                </div>
                            </div>
                            <div className="flex items-center gap-4">
                                <div className="text-right">
                                    <p className="text-[10px] text-gray-500 font-bold uppercase tracking-wider">Estimated Cost</p>
                                    <p className="text-lg font-bold text-indigo-900">${totalEstimate.toLocaleString()}</p>
                                </div>
                                <button onClick={() => setShowInvoice(true)} className="bg-gray-900 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-800 shadow-lg flex items-center gap-2">
                                    <Icon name="fileText" size={16} /> Client View
                                </button>
                            </div>
                        </header>

                        {/* Block Canvas */}
                        <div className="flex-1 overflow-y-auto p-8 custom-scrollbar">
                            <div className="max-w-4xl mx-auto space-y-4 pb-20">
                                {activeProject.blocks && activeProject.blocks.length === 0 && (
                                    <div className="text-center py-20 opacity-50 border-2 border-dashed border-gray-300 rounded-xl">
                                        <p>Start building your production line.</p>
                                        <p className="text-sm">Select a block type from the right.</p>
                                    </div>
                                )}

                                {activeProject.blocks && activeProject.blocks.map((block, index) => (
                                    <div key={block.id} className={`block-card bg-white/90 backdrop-blur rounded-xl p-4 shadow-sm border border-gray-100 flex gap-4 items-start group animate-fade-in block-type-${block.type}`}>
                                        <div className="pt-1 text-gray-400 cursor-grab">
                                            <Icon name="layers" size={16} />
                                        </div>
                                        
                                        <div className="flex-1 space-y-3">
                                            {/* Top Row: Title and Price */}
                                            <div className="flex justify-between items-start">
                                                <input 
                                                    type="text" 
                                                    value={block.title} 
                                                    onChange={(e) => updateBlock(block.id, 'title', e.target.value)}
                                                    className="font-bold text-gray-800 bg-transparent border-none focus:ring-0 p-0 text-lg w-full"
                                                />
                                                <div className="flex items-center gap-1 bg-gray-50 px-2 py-1 rounded-md border border-gray-200">
                                                    <span className="text-gray-400 text-xs">$</span>
                                                    <input 
                                                        type="number" 
                                                        value={block.price} 
                                                        onChange={(e) => updateBlock(block.id, 'price', e.target.value)}
                                                        className="w-20 bg-transparent text-right font-mono font-medium text-sm focus:outline-none"
                                                        placeholder="0.00"
                                                    />
                                                </div>
                                            </div>

                                            {/* Middle Row: Links and Notes */}
                                            <div className="grid grid-cols-2 gap-4">
                                                <div className="flex items-center gap-2 bg-gray-50/50 p-2 rounded-lg border border-transparent focus-within:border-indigo-200 transition-colors">
                                                    <Icon name="link" size={14} className="text-gray-400" />
                                                    <input 
                                                        type="text" 
                                                        placeholder="Add reference link..." 
                                                        value={block.link}
                                                        onChange={(e) => updateBlock(block.id, 'link', e.target.value)}
                                                        className="bg-transparent text-xs w-full focus:outline-none text-blue-600"
                                                    />
                                                </div>
                                                <div className="flex items-center gap-2 bg-gray-50/50 p-2 rounded-lg border border-transparent focus-within:border-indigo-200 transition-colors">
                                                    <Icon name="fileText" size={14} className="text-gray-400" />
                                                    <input 
                                                        type="text" 
                                                        placeholder="Add specifications/notes..." 
                                                        value={block.notes}
                                                        onChange={(e) => updateBlock(block.id, 'notes', e.target.value)}
                                                        className="bg-transparent text-xs w-full focus:outline-none text-gray-600"
                                                    />
                                                </div>
                                            </div>
                                        </div>

                                        {/* Actions */}
                                        <div className="flex flex-col gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                            <button 
                                                onClick={() => updateBlock(block.id, 'completed', !block.completed)}
                                                className={`p-1.5 rounded-md ${block.completed ? 'bg-green-100 text-green-600' : 'bg-gray-100 text-gray-400 hover:bg-green-50 hover:text-green-500'}`}
                                            >
                                                <Icon name="check" size={16} />
                                            </button>
                                            <button onClick={() => deleteBlock(block.id)} className="p-1.5 rounded-md bg-gray-100 text-gray-400 hover:bg-red-50 hover:text-red-500">
                                                <Icon name="trash" size={16} />
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>

                    {/* --- RIGHT SIDEBAR (Toolbox) --- */}
                    <div className="w-64 bg-white/60 backdrop-blur-md border-l border-white/50 p-5 flex flex-col z-10 shadow-xl">
                        <h3 className="text-xs font-bold text-gray-500 uppercase tracking-wider mb-4">Toolbox</h3>
                        <div className="space-y-3">
                            <button onClick={() => addBlock('service')} className="w-full bg-white hover:bg-indigo-50 border border-gray-200 p-3 rounded-xl flex items-center gap-3 shadow-sm hover:shadow-md transition-all group text-left">
                                <div className="w-8 h-8 rounded-lg bg-indigo-100 text-indigo-600 flex items-center justify-center group-hover:bg-indigo-600 group-hover:text-white transition-colors">
                                    <Icon name="box" />
                                </div>
                                <div>
                                    <p className="text-sm font-bold text-gray-800">Service</p>
                                    <p className="text-[10px] text-gray-500">Editing, Design, Dev</p>
                                </div>
                            </button>

                            <button onClick={() => addBlock('material')} className="w-full bg-white hover:bg-orange-50 border border-gray-200 p-3 rounded-xl flex items-center gap-3 shadow-sm hover:shadow-md transition-all group text-left">
                                <div className="w-8 h-8 rounded-lg bg-orange-100 text-orange-600 flex items-center justify-center group-hover:bg-orange-600 group-hover:text-white transition-colors">
                                    <Icon name="layers" />
                                </div>
                                <div>
                                    <p className="text-sm font-bold text-gray-800">Material</p>
                                    <p className="text-[10px] text-gray-500">Assets, Stock, Sub</p>
                                </div>
                            </button>

                            <button onClick={() => addBlock('milestone')} className="w-full bg-white hover:bg-green-50 border border-gray-200 p-3 rounded-xl flex items-center gap-3 shadow-sm hover:shadow-md transition-all group text-left">
                                <div className="w-8 h-8 rounded-lg bg-green-100 text-green-600 flex items-center justify-center group-hover:bg-green-600 group-hover:text-white transition-colors">
                                    <Icon name="check" />
                                </div>
                                <div>
                                    <p className="text-sm font-bold text-gray-800">Milestone</p>
                                    <p className="text-[10px] text-gray-500">Delivery, Review</p>
                                </div>
                            </button>
                        </div>

                        <div className="mt-auto bg-blue-50 p-4 rounded-xl border border-blue-100">
                            <p className="text-xs font-medium text-blue-800 mb-1">ðŸ’¡ Pro Tip</p>
                            <p className="text-[10px] text-blue-600 leading-relaxed">
                                Build your package by clicking items above. Values update the estimate automatically.
                            </p>
                        </div>
                    </div>

                    {/* --- MODALS --- */}
                    
                    {/* Settings Modal */}
                    {showSettings && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm">
                            <div className="bg-white rounded-2xl p-6 w-96 shadow-2xl animate-fade-in">
                                <div className="flex justify-between items-center mb-6">
                                    <h3 className="font-bold text-lg">Company Settings</h3>
                                    <button onClick={() => setShowSettings(false)} className="text-gray-400 hover:text-gray-600"><Icon name="x" /></button>
                                </div>
                                <div className="space-y-4">
                                    <div>
                                        <label className="text-xs font-bold text-gray-500 uppercase block mb-1">Company Name</label>
                                        <input type="text" value={settings.companyName} onChange={(e) => setSettings({...settings, companyName: e.target.value})} className="w-full p-2 border rounded-lg text-sm bg-gray-50" />
                                    </div>
                                    <div>
                                        <label className="text-xs font-bold text-gray-500 uppercase block mb-1">Logo URL</label>
                                        <input type="text" value={settings.logoUrl} onChange={(e) => setSettings({...settings, logoUrl: e.target.value})} placeholder="https://..." className="w-full p-2 border rounded-lg text-sm bg-gray-50" />
                                    </div>
                                    <div>
                                        <label className="text-xs font-bold text-gray-500 uppercase block mb-1">Wallpaper URL</label>
                                        <input type="text" value={settings.bgImage} onChange={(e) => setSettings({...settings, bgImage: e.target.value})} className="w-full p-2 border rounded-lg text-sm bg-gray-50" />
                                    </div>
                                    <div className="flex justify-between pt-4">
                                        <button onClick={logout} className="text-red-500 text-sm font-medium hover:underline">Sign Out</button>
                                        <button onClick={() => { updateSettings(settings); setShowSettings(false); }} className="bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm font-bold">Save Changes</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Invoice/Client Modal */}
                    {showInvoice && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm">
                            <div className="bg-white w-[600px] min-h-[500px] rounded-sm shadow-2xl animate-fade-in flex flex-col">
                                <div className="p-8 flex-1">
                                    <div className="flex justify-between items-start border-b border-gray-100 pb-8 mb-8">
                                        <div>
                                            {settings.logoUrl && <img src={settings.logoUrl} className="h-10 mb-2" />}
                                            <h2 className="font-bold text-2xl text-gray-800">{settings.companyName}</h2>
                                            <p className="text-sm text-gray-500">Production Estimate</p>
                                        </div>
                                        <div className="text-right">
                                            <p className="text-xs text-gray-400 uppercase">Date</p>
                                            <p className="text-sm font-medium">{new Date().toLocaleDateString()}</p>
                                            <p className="text-xs text-gray-400 uppercase mt-2">Project</p>
                                            <p className="text-sm font-medium">{activeProject.name}</p>
                                        </div>
                                    </div>
                                    
                                    <table className="w-full text-left text-sm">
                                        <thead>
                                            <tr className="border-b border-gray-200 text-gray-500 uppercase text-xs">
                                                <th className="pb-2">Description</th>
                                                <th className="pb-2">Type</th>
                                                <th className="pb-2 text-right">Amount</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-100">
                                            {activeProject.blocks.map(b => (
                                                <tr key={b.id}>
                                                    <td className="py-3">
                                                        <p className="font-medium text-gray-800">{b.title}</p>
                                                        {b.notes && <p className="text-xs text-gray-400">{b.notes}</p>}
                                                    </td>
                                                    <td className="py-3">
                                                        <span className="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded capitalize">{b.type}</span>
                                                    </td>
                                                    <td className="py-3 text-right font-mono">${parseFloat(b.price || 0).toLocaleString()}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                                <div className="bg-gray-50 p-8 border-t border-gray-100 flex justify-between items-center">
                                    <button onClick={() => setShowInvoice(false)} className="text-gray-500 hover:text-gray-800 text-sm font-medium">Close View</button>
                                    <div className="text-right">
                                        <p className="text-xs text-gray-500 uppercase font-bold">Total Estimate</p>
                                        <p className="text-3xl font-bold text-indigo-900">${totalEstimate.toLocaleString()}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>